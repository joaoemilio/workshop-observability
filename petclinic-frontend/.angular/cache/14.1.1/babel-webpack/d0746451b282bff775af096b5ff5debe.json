{"ast":null,"code":"var _serviceCreators;\n\nimport ApmServer from './apm-server';\nimport ConfigService from './config-service';\nimport LoggingService from './logging-service';\nimport { CONFIG_CHANGE, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER } from './constants';\nimport { __DEV__ } from '../state';\nvar serviceCreators = (_serviceCreators = {}, _serviceCreators[CONFIG_SERVICE] = function () {\n  return new ConfigService();\n}, _serviceCreators[LOGGING_SERVICE] = function () {\n  return new LoggingService({\n    prefix: '[Elastic APM] '\n  });\n}, _serviceCreators[APM_SERVER] = function (factory) {\n  var _factory$getService = factory.getService([CONFIG_SERVICE, LOGGING_SERVICE]),\n      configService = _factory$getService[0],\n      loggingService = _factory$getService[1];\n\n  return new ApmServer(configService, loggingService);\n}, _serviceCreators);\n\nvar ServiceFactory = function () {\n  function ServiceFactory() {\n    this.instances = {};\n    this.initialized = false;\n  }\n\n  var _proto = ServiceFactory.prototype;\n\n  _proto.init = function init() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.initialized = true;\n    var configService = this.getService(CONFIG_SERVICE);\n    configService.init();\n\n    var _this$getService = this.getService([LOGGING_SERVICE, APM_SERVER]),\n        loggingService = _this$getService[0],\n        apmServer = _this$getService[1];\n\n    configService.events.observe(CONFIG_CHANGE, function () {\n      var logLevel = configService.get('logLevel');\n      loggingService.setLevel(logLevel);\n    });\n    apmServer.init();\n  };\n\n  _proto.getService = function getService(name) {\n    var _this = this;\n\n    if (typeof name === 'string') {\n      if (!this.instances[name]) {\n        if (typeof serviceCreators[name] === 'function') {\n          this.instances[name] = serviceCreators[name](this);\n        } else if (__DEV__) {\n          console.log('Cannot get service, No creator for: ' + name);\n        }\n      }\n\n      return this.instances[name];\n    } else if (Array.isArray(name)) {\n      return name.map(function (n) {\n        return _this.getService(n);\n      });\n    }\n  };\n\n  return ServiceFactory;\n}();\n\nexport { serviceCreators, ServiceFactory };","map":null,"metadata":{},"sourceType":"module"}